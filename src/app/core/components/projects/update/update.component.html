<mat-card style="padding:0;">
    {{project | json}}
    <mat-card-title>Title: {{project ? project.project_title : null}}</mat-card-title>
    <div class="projectinfo">

        <table class="infotable" *ngIf="project">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Value</th>
                </tr>
            </thead>

            <tbody>
                <tr>
                    <td>Project State</td>
                    <td>{{project.state}}</td>
                </tr>
                <tr>
                    <td>Quota: </td>
                    <td>{{project.quota | currency}}</td>

                </tr>
                <tr>
                    <td>Scheduled to begin: (defaultstart) </td>
                    <td>{{project.defaultstart | date: 'short'}}</td>
                </tr>
                <tr>
                    <td>
                        Project state
                    </td>
                    <td>
                        {{project.state ==='Open' ? 'Open' : 'Closed'}}
                    </td>
                </tr>
                <tr *ngIf="project.link_method ==='Direct'; else fixed">
                    <td>
                        The project link method is <b>Direct</b>
                        <br>
                        You wish to have a sample size of <b>{{project.desired_sample_size}}</b> participants,
                        with a maximum of <b> {{project.desired_num_invitations}}</b> invitations
                        <br>
                    </td>
                </tr>
                <ng-template #fixed>
                    The payout type is <b>Fixed</b>
                </ng-template>

                <tr *ngIf=" !project.quota || parseInt(project.quota) <= 0;else quota">
                    <span class="error"> You have no quota with which to pay participants, only the
                        administrator can change the
                        quota. </span>
                </tr>
                <ng-template #quota>
                    Your quota for the project is {{project.quota}}
                </ng-template>
                <tr *ngIf="project.link_method ==='Direct'">
                    The link method is <strong>Direct</strong>. There are no automatic payments.
                    You wish to have a sample size of {{project.desired_sample_size}} participants,
                    with a maximum of {{project.desired_num_invitations}} invitations.
                </tr>
                <tr *ngIf="project.payout_type ==='Fixed'">Payout type is <b>Fixed</b>
                </tr>
                <tr *ngIf="project.payout_type !== 'Fixed' && project.payout_type !=='Variable'">
                    <td>Payout
                        type is
                        'Variable'.</td>
                </tr>
                <tr *ngIf="project.exp_payout > project.max_payout">
                    <td>
                        <span class="error">The expected payout ({{project.exp_payout}}) is larger than the maximum
                            payout
                            {{project.max_payout}} </span></td>
                </tr>
                <tr class="error">Warn if selected participants fewer than the desired sample size</tr>
                <tr>
                    <td> Status on reminders and participants completed survey etc. ..</td>

                </tr>
                <tr *ngIf="project.state ==='Design'">
                    <h2 class="primary success"> This project is in the design stage, you may select participants
                    </h2>
                </tr>
                <tr>
                    <td>
                        Number of selected participants: {{totalParticipants}}
                    </td>
                    <td>
                        Desired sample size: {{project.desired_sample_size}}
                    </td>
                </tr>
                <tr *ngIf="totalParticipants > parseInt(project.desired_sample_size); else moreParticipants">
                    <mat-icon>check</mat-icon> You have at least the desired number of participants
                </tr>
                <ng-template #moreParticipants>
                    <td class="error" colspan="3">
                        <h2>You need more participants to satisfy your target sample size</h2>
                    </td>
                </ng-template>
                <div style="background:white;"
                    *ngIf="totalParticipants > parseInt(project.desired_sample_size); else moreParticipants">
                    You can change the project state from 'Design' to 'Started' to start the project

                    <button (click)="startProject();">Start Project</button>
                </div>
                <div *ngIf="project.state =='Started'" class="alert-success">
                    <h2>The project is started. You may send invitations to project participants </h2>
                </div>

            </tbody>
        </table>
    </div>



    <!-- <div *ngIf="project.link_method ==='Direct'">
        The link method is <strong>Direct</strong>. There are no automatic payments.
        You wish to have a sample size of {{project.desired_sample_size}} participants,
        with a maximum of {{project.desired_num_invitations}} invitations.
    </div>
    <ng-template *ngIf=" project.payout_type==='Fixed'">Payout type is <b>Fixed</b></ng-template> -->
    <!-- <ng-template *ngIf=" project.payout_type !=='Fixed' && project.payout_type !=='Variable'">Payout
        type is
        'Variable'. <br> </ng-template> -->


    <!-- <div *ngIf=" project.exp_payout> project.max_payout">
                    <span class="error">The expected payout ({{project.exp_payout}}) is larger than the maximum
                        payout
                        {{project.max_payout}} </span>
    </div> -->
    <!-- <h2 class="error">Warn if selected participants fewer than the desired sample size</h2>
    <div>
    </div> -->
    <mat-tab-group dynamicHeight>

        <mat-tab label="Select participants">
            <mat-card>
                <mat-card-title>Select participants</mat-card-title>
                <app-selection-table>
                </app-selection-table>
            </mat-card>
        </mat-tab>
        <mat-tab label="Manage selection">
            <mat-card>
                <mat-card-title>Manage selection</mat-card-title>
                <div *ngIf="participants">
                    <app-manage-participants [project]="project" [participants]="participants">
                    </app-manage-participants>
                </div>


            </mat-card>
        </mat-tab>

        <mat-tab label="Edit Project">
            Edit Project ðŸ’¼
            <!-- {{editForm.value | json}} -->
            <form [formGroup]="editForm" (ngSubmit)="onSubmit()" style="display:grid;">
                <div [hidden]="true">
                    <input type="text" formControlName="id" placeholder="id" name="id" class="form-control" id="id">
                </div>
                <mat-form-field appearance="outline">
                    <mat-label>Planned project start</mat-label>
                    <input formControlName="defaultstart" matInput [matDatepicker]="picker2">
                    <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                    <mat-datepicker #picker2></mat-datepicker>
                </mat-form-field>
                <mat-form-field appearance="outline">
                    <mat-label>End of project</mat-label>
                    <input formControlName="defaultend" matInput [matDatepicker]="picker">
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                </mat-form-field>
                <mat-form-field appearance="outline">
                    <mat-label>Link to external study</mat-label>
                    <input matInput type="text" formControlName="link" placeholder="link" name="link"
                        class="form-control" id="">

                </mat-form-field>
                <span style="width:100%;margin-left:5px;">
                    Test Link:
                    <code> <a href="{{editForm.value.link}}">{{editForm.value.link}}</a></code>
                </span>

                <mat-form-field appearance="outline">
                    <mat-label>Link method</mat-label>
                    <mat-select placeholder="Link method" formControlName="link_method" name="link_method">
                        <mat-option value="Direct">
                            Login Required L.R. - simple link
                        </mat-option>
                        <mat-option value="Login">
                            L.R. Link with named paramters
                        </mat-option>
                        <mat-option value="LoginInfo">
                            L.R. Link with Unipark-style paramters
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                <mat-form-field appearance="outline">
                    <mat-label>Responsible Person</mat-label>
                    <input matInput type="text" formControlName="responsible_person" placeholder="responsible_person"
                        name="responsible_person" class="form-control" id="responsible_person">
                </mat-form-field>
                <mat-form-field appearance="outline">
                    <mat-label>Desired sample size</mat-label>
                    <input matInput type="number" formControlName="desired_sample_size"
                        placeholder="desired_sample_size" name="desired_sample_size" class="form-control"
                        id="desired_sample_size">
                </mat-form-field>
                <mat-form-field appearance="outline">
                    <mat-label>Desired number of Invitations</mat-label>
                    <input matInput type="number" formControlName="desired_num_invitations"
                        placeholder="desired_num_invitations" name="desired_num_invitations" class="form-control"
                        id="desired_num_invitations">
                </mat-form-field>
                <mat-form-field appearance="outline">
                    <mat-label>Payout size</mat-label>

                    <mat-select placeholder="Payout type" formControlName="payout_type" name="payout_type">
                        <mat-option value="Fixed">
                            Fixed
                        </mat-option>
                        <mat-option value="Variable">
                            Variable
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                <mat-form-field appearance="outline">
                    <mat-label>Max payout</mat-label>
                    <input matInput type="number" formControlName="max_payout" placeholder="max_payout"
                        name="max_payout" class="form-control" id="max_payout">
                </mat-form-field>
                <mat-form-field appearance="outline">
                    <mat-label>Expected payout</mat-label>
                    <input matInput type="number" formControlName="exp_payout" placeholder="exp_payout"
                        name="exp_payout" class="form-control" id="exp_payout">
                </mat-form-field>
                <mat-form-field appearance="outline">
                    <mat-label> Project title:</mat-label>
                    <input matInput type="text" formControlName="project_title" placeholder="project_title"
                        name="project_title" class="form-control" id="project_title">
                </mat-form-field>
                <mat-form-field appearance="outline">
                    <mat-label> Description:</mat-label>
                    <input matInput type="text" formControlName="description" placeholder="Description"
                        name="description" class="form-control" id="description">
                </mat-form-field>
                <button [disabled]="editForm.value.errors" mat-stroked-button color="primary">Update</button>
            </form>
        </mat-tab>
        <mat-tab label="Project Settings">
            <mat-accordion>
                <!-- <mat-expansion-panel>
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            Edit Email Templates
                        </mat-panel-title>
                        <mat-panel-description>
                            Add and configure templates
                        </mat-panel-description>
                    </mat-expansion-panel-header>
                    <p>Edit email content</p>
                </mat-expansion-panel> -->
                <mat-expansion-panel>
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            Import/Export Participant Data
                        </mat-panel-title>
                        <mat-panel-description>
                            <!-- //csv -->
                        </mat-panel-description>
                    </mat-expansion-panel-header>
                    <p>CSV import/export form</p>
                </mat-expansion-panel>
                <mat-expansion-panel>
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            Test project links
                        </mat-panel-title>
                        <mat-panel-description>
                            <mat-icon>search</mat-icon>
                        </mat-panel-description>
                    </mat-expansion-panel-header>
                    <p>I'm visible because I am open</p>
                </mat-expansion-panel>
            </mat-accordion>
        </mat-tab>
        <mat-tab label="Edit email templates">
            <mat-card>
                <app-email-templates></app-email-templates>
            </mat-card>
        </mat-tab>


    </mat-tab-group>